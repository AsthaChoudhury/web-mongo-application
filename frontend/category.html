<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="assets/css/style.css"/>
    <title>Recipes</title>
</head>
<body>
    <header id="header-container"></header>

    <main class="main">
        <section class="recipe" id="recipe-section">
        </section>
        <div id="error-message" class="error-message"></div>
    </main>

    <script type="module">
        import { loadHeader } from './assets/js/loadHeader.js';

        document.addEventListener("DOMContentLoaded", () => {
            loadHeader();
            const params = new URLSearchParams(window.location.search);
            const category = params.get('category');
            console.log(category);
            
            if (category) {
                loadRecipes(category); 
            } else {
                displayErrorMessage('No category selected!'); 
            }
        });

        async function loadRecipes(category) {
            try {
                const response = await fetch(`/api/recipes/category/${category}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
        
                const recipes = await response.json();
                const recipeSection = document.getElementById('recipe-section');
                recipeSection.innerHTML = '';
        
                if (recipes.length === 0) {
                    displayErrorMessage('No recipes found for this category.');
                    return;
                }
        
                recipes.forEach(recipe => {
                    const recipeCard = document.createElement('a');
                    recipeCard.href = `recipelayout.html?id=${recipe._id}`;
                    recipeCard.className = "cake_circle swiper__slide";
        
                    recipeCard.innerHTML = `
                        <img src="${recipe.image || 'assets/img/default.jpg'}" alt="${recipe.title}" class="cake__icon">
                        <h3 class="cake__title">${recipe.title.toUpperCase()}</h3>
                    `;
                    recipeSection.appendChild(recipeCard);
                });
        
            } catch (error) {
                console.error("Error loading recipes:", error);
                displayErrorMessage('There was an error loading the recipes. Please try again later.');
            }
        }
        

        function displayErrorMessage(message) {
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block'; 
        }
    </script>
</body>
</html>
